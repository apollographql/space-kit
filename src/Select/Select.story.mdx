import userEvent from "@testing-library/user-event";
import { findByRole } from "@testing-library/dom";
import { Meta, Story, ArgsTable, Canvas } from "@storybook/addon-docs/blocks";
import { PerformUserInteraction } from "../shared/PerformUserInteraction";
import { Select as SpaceKitSelect } from "../Select";

<Meta title="Form/Select" component={SpaceKitSelect} />

export const Select = (props) => {
  return (
    <PerformUserInteraction
      callback={async () => {
        if (document.querySelector(".sbdocs")) {
          // Do not perform interaction automatically if in Docs mode
          return;
        }
        userEvent.click(await findByRole(document.body, "button"));
      }}
    >
      <SpaceKitSelect {...props} />
    </PerformUserInteraction>
  );
};

# Select

**Select** is emulates a native `select` element, but rendered with Space Kit appearances.

You must use the same `<option>` and `<optgroup>` elements you would use for a native `select` element. Any nested components will not work.

<Canvas>
  <Story name="basic options">
    <Select label={<>select an item</>} initialValue="">
      <option value="">Select an option</option>
      <option value="value a">a</option>
      <option value="value b">b</option>
    </Select>
  </Story>
  <Story name="basic optgroup">
    <Select label={<>select an item</>}>
      <optgroup label="Group of options">
        <option value="value a">a</option>
        <option value="value b">b</option>
      </optgroup>
      <optgroup label="Second of options">
        <option value="value c">c</option>
        <option value="value d">d</option>
      </optgroup>
    </Select>
  </Story>
  <Story name="disabled">
    <Select label="disabled" disabled>
      <option value="value a">a</option>
      <option value="value b">b</option>
    </Select>
  </Story>
</Canvas>

## Control

`Select` is intended to be a bare replacement for a `<select>` element. It can be either controlled or uncontrolled, see the [React: Uncontrolled Components](https://reactjs.org/docs/uncontrolled-components.html) docs for a more in-depth explanation.

For controlled components, you must pass a `value` prop and have the option to pass an `onChange` prop. If you don't use an `onChange` prop, as expected, the `value` can not be changed.

If you elect to use an uncontrolled component, do not pass `value` or `onChange` props. You can pass a `initialValue` for the initial to be set and then the component will control the on it's own.

## Options

### Feel

Selects can be displayed using any of the `feel` values from `Button`.

<Canvas>
  <Story name="feel raised">
    <Select label={<>select an item</>} feel="raised">
      <option>a</option>
      <optgroup label="header 1">
        <option>b</option>
      </optgroup>
    </Select>
  </Story>
  <Story name="feel flat">
    <Select label={<>select an item</>} feel="flat">
      <option>a</option>
      <optgroup label="header 1">
        <option>b</option>
      </optgroup>
    </Select>
  </Story>
</Canvas>

### Size

By default, the component will match the width of it's content. The dropdown list will also match the size of the content. There are a few presets you can use to configure the width of the select trigger and you can have the dropdown list match the width of the trigger.

#### Automatic Size

<Canvas>
  <Story name="Automatic Size, Narrow">
    <Select value="a">
      <option>a</option>
    </Select>
  </Story>
  <Story name="Automatic Size, Wide">
    <Select value="this is a super long to show how wide the select will be">
      <option>this is a super long to show how wide the select will be</option>
    </Select>
  </Story>
</Canvas>

#### Sizes

Selects will grow and shrink with the content to up until a point (TBD)

<Canvas>
  <Story name="Small, Not Truncated">
    <Select size="small" value="small">
      <option>small</option>
    </Select>
  </Story>
  <Story name="Small, Truncated">
    <Select size="small" value="small truncated">
      <option>small truncated</option>
    </Select>
  </Story>
  <Story name="Medium, Not Truncated">
    <Select size="medium" value="medium">
      <option>medium</option>
    </Select>
  </Story>
  <Story name="Medium, Truncated">
    <Select size="medium" value="medium truncated truncated">
      <option>medium truncated truncated</option>
    </Select>
  </Story>
  <Story name="Large, Not Truncated">
    <Select size="large" value="large">
      <option>large</option>
    </Select>
  </Story>
  <Story name="Large, Truncated">
    <Select size="large" value="large truncated truncated">
      <option>large truncated truncated</option>
    </Select>
  </Story>
  <Story name="Extra Large, Not Truncated">
    <Select size="extra large" value="extra large">
      <option>extra large</option>
    </Select>
  </Story>
  <Story name="Extra Large, Truncated">
    <Select size="extra large" value="extra large truncated truncated">
      <option>extra large truncated truncated</option>
    </Select>
  </Story>
</Canvas>

### Match Trigger width

The menu width can be fixed to match the trigger button size with the `matchTriggerWidth` prop. This is most useful when you yourself define the size of the select element.

<Canvas>
  <Story name="Match Trigger Prop">
    <Select value="small" matchTriggerWidth style={{ width: 150 }}>
      <option>small</option>
      <option>medium</option>
      <option>large</option>
    </Select>
  </Story>
</Canvas>

## Props

<ArgsTable of={SpaceKitSelect} />
